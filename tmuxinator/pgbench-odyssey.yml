name: pgbench-odyssey
root: ~/loadtest
pre_window: ulimit -n 1048576
windows:
  - tester:
      layout: main-vertical
      panes:
        - pgbench --host=localhost --jobs=2 --client=1000 --time=60 --port=6432
  - user:
      panes:
        - POSTGRES="host=localhost port=6432 user=$USER password=$PGPASSWORD dbname=$USER" ./bin/testing-service -p 9001
        - while true; do time curl http://localhost:9001/hasql/item?th=false&transaction=true&release=true ; sleep 1; done
  - pooler:
      - cd odyssey; make console_run
